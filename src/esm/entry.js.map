{"version":3,"file":"entry.js","names":["processTpl","genLinkReplaceSymbol","getInlineStyleReplaceSymbol","defaultGetPublicPath","getInlineCode","requestIdleCallback","error","compose","getCurUrl","WUJIE_TIPS_NO_FETCH","WUJIE_TIPS_SCRIPT_ERROR_REQUESTED","WUJIE_TIPS_CSS_ERROR_REQUESTED","WUJIE_TIPS_HTML_ERROR_REQUESTED","getEffectLoaders","isMatchUrl","styleCache","scriptCache","embedHTMLCache","window","fetch","Error","defaultFetch","bind","defaultGetTemplate","tpl","processCssLoader","_x","_x2","_x3","_processCssLoader","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee","sandbox","template","getExternalStyleSheets","curUrl","composeCssLoader","processedCssList","embedHTML","wrap","_callee$","_context","prev","next","proxyLocation","plugins","map","plugin","cssLoader","_ref2","src","ignore","contentPromise","then","content","getEmbedHTML","sent","abrupt","replace","stop","_x4","_x5","_getEmbedHTML","_callee2","styleResultList","_callee2$","_context2","Promise","all","styleResult","index","concat","isInlineCode","code","startsWith","fetchAssets","cache","cssFlag","loadError","response","status","text","e","styles","length","undefined","_ref","resolve","_getExternalStyleSheets","getExternalScripts","scripts","fiber","script","async","defer","module","reject","_objectSpread","_getExternalScripts","importHTML","params","_opts$fetch","_opts$fiber","url","opts","html","htmlLoader","jsExcludes","cssExcludes","jsIgnores","cssIgnores","getPublicPath","getHtmlParseResult","assetPublicPath","_processTpl","filter","style","some"],"sources":["../src/entry.ts"],"sourcesContent":["import processTpl, {\r\n  genLinkReplaceSymbol,\r\n  getInlineStyleReplaceSymbol,\r\n  ScriptObject,\r\n  ScriptBaseObject,\r\n  StyleObject,\r\n} from \"./template\";\r\nimport { defaultGetPublicPath, getInlineCode, requestIdleCallback, error, compose, getCurUrl } from \"./utils\";\r\nimport {\r\n  WUJIE_TIPS_NO_FETCH,\r\n  WUJIE_TIPS_SCRIPT_ERROR_REQUESTED,\r\n  WUJIE_TIPS_CSS_ERROR_REQUESTED,\r\n  WUJIE_TIPS_HTML_ERROR_REQUESTED,\r\n} from \"./constant\";\r\nimport { getEffectLoaders, isMatchUrl } from \"./plugin\";\r\nimport Wujie from \"./sandbox\";\r\nimport { plugin, loadErrorHandler } from \"./index\";\r\n\r\nexport type ScriptResultList = (ScriptBaseObject & { contentPromise: Promise<string> })[];\r\nexport type StyleResultList = { src: string; contentPromise: Promise<string>; ignore?: boolean }[];\r\n\r\ninterface htmlParseResult {\r\n  template: string;\r\n\r\n  assetPublicPath: string;\r\n\r\n  getExternalScripts(): ScriptResultList;\r\n\r\n  getExternalStyleSheets(): StyleResultList;\r\n}\r\n\r\ntype ImportEntryOpts = {\r\n  fetch?: typeof window.fetch;\r\n  fiber?: boolean;\r\n  plugins?: Array<plugin>;\r\n  loadError?: loadErrorHandler;\r\n};\r\n\r\nconst styleCache = {};\r\nconst scriptCache = {};\r\nconst embedHTMLCache = {};\r\n\r\nif (!window.fetch) {\r\n  error(WUJIE_TIPS_NO_FETCH);\r\n  throw new Error();\r\n}\r\nconst defaultFetch = window.fetch.bind(window);\r\n\r\nfunction defaultGetTemplate(tpl) {\r\n  return tpl;\r\n}\r\n\r\n/**\r\n * 处理css-loader\r\n */\r\nexport async function processCssLoader(\r\n  sandbox: Wujie,\r\n  template: string,\r\n  getExternalStyleSheets: () => StyleResultList\r\n): Promise<string> {\r\n  const curUrl = getCurUrl(sandbox.proxyLocation);\r\n  /** css-loader */\r\n  const composeCssLoader = compose(sandbox.plugins.map((plugin) => plugin.cssLoader));\r\n  const processedCssList: StyleResultList = getExternalStyleSheets().map(({ src, ignore, contentPromise }) => ({\r\n    src,\r\n    ignore,\r\n    contentPromise: contentPromise.then((content) => composeCssLoader(content, src, curUrl)),\r\n  }));\r\n  const embedHTML = await getEmbedHTML(template, processedCssList);\r\n  return sandbox.replace ? sandbox.replace(embedHTML) : embedHTML;\r\n}\r\n\r\n/**\r\n * convert external css link to inline style for performance optimization\r\n * @return embedHTML\r\n */\r\nasync function getEmbedHTML(template, styleResultList: StyleResultList): Promise<string> {\r\n  let embedHTML = template;\r\n\r\n  return Promise.all(\r\n    styleResultList.map((styleResult, index) =>\r\n      styleResult.contentPromise.then((content) => {\r\n        if (styleResult.src) {\r\n          embedHTML = embedHTML.replace(\r\n            genLinkReplaceSymbol(styleResult.src),\r\n            styleResult.ignore\r\n              ? `<link href=\"${styleResult.src}\" rel=\"stylesheet\" type=\"text/css\">`\r\n              : `<style>/* ${styleResult.src} */${content}</style>`\r\n          );\r\n        } else if (content) {\r\n          embedHTML = embedHTML.replace(\r\n            getInlineStyleReplaceSymbol(index),\r\n            `<style>/* inline-style-${index} */${content}</style>`\r\n          );\r\n        }\r\n      })\r\n    )\r\n  ).then(() => embedHTML);\r\n}\r\n\r\nconst isInlineCode = (code) => code.startsWith(\"<\");\r\n\r\nconst fetchAssets = (\r\n  src: string,\r\n  cache: Object,\r\n  fetch: (input: RequestInfo, init?: RequestInit) => Promise<Response>,\r\n  cssFlag?: boolean,\r\n  loadError?: loadErrorHandler\r\n) =>\r\n  cache[src] ||\r\n  (cache[src] = fetch(src)\r\n    .then((response) => {\r\n      // usually browser treats 4xx and 5xx response of script loading as an error and will fire a script error event\r\n      // https://stackoverflow.com/questions/5625420/what-http-headers-responses-trigger-the-onerror-handler-on-a-script-tag/5625603\r\n      if (response.status >= 400) {\r\n        cache[src] = null;\r\n        if (cssFlag) {\r\n          error(WUJIE_TIPS_CSS_ERROR_REQUESTED, { src, response });\r\n          loadError?.(src, new Error(WUJIE_TIPS_CSS_ERROR_REQUESTED));\r\n          return \"\";\r\n        } else {\r\n          error(WUJIE_TIPS_SCRIPT_ERROR_REQUESTED, { src, response });\r\n          loadError?.(src, new Error(WUJIE_TIPS_SCRIPT_ERROR_REQUESTED));\r\n          throw new Error(WUJIE_TIPS_SCRIPT_ERROR_REQUESTED);\r\n        }\r\n      }\r\n      return response.text();\r\n    })\r\n    .catch((e) => {\r\n      cache[src] = null;\r\n      if (cssFlag) {\r\n        error(WUJIE_TIPS_CSS_ERROR_REQUESTED, src);\r\n        loadError?.(src, e);\r\n        return \"\";\r\n      } else {\r\n        error(WUJIE_TIPS_SCRIPT_ERROR_REQUESTED, src);\r\n        loadError?.(src, e);\r\n        return \"\";\r\n      }\r\n    }));\r\n\r\n// for prefetch\r\nexport function getExternalStyleSheets(\r\n  styles: StyleObject[],\r\n  fetch: (input: RequestInfo, init?: RequestInit) => Promise<Response> = defaultFetch,\r\n  loadError: loadErrorHandler\r\n): StyleResultList {\r\n  return styles.map(({ src, content, ignore }) => {\r\n    // 内联\r\n    if (content) {\r\n      return { src: \"\", contentPromise: Promise.resolve(content) };\r\n    } else if (isInlineCode(src)) {\r\n      // if it is inline style\r\n      return { src: \"\", contentPromise: Promise.resolve(getInlineCode(src)) };\r\n    } else {\r\n      // external styles\r\n      return {\r\n        src,\r\n        ignore,\r\n        contentPromise: ignore ? Promise.resolve(\"\") : fetchAssets(src, styleCache, fetch, true, loadError),\r\n      };\r\n    }\r\n  });\r\n}\r\n\r\n// for prefetch\r\nexport function getExternalScripts(\r\n  scripts: ScriptObject[],\r\n  fetch: (input: RequestInfo, init?: RequestInit) => Promise<Response> = defaultFetch,\r\n  loadError: loadErrorHandler,\r\n  fiber: boolean\r\n): ScriptResultList {\r\n  // module should be requested in iframe\r\n  return scripts.map((script) => {\r\n    const { src, async, defer, module, ignore } = script;\r\n    let contentPromise = null;\r\n    // async\r\n    if ((async || defer) && src && !module) {\r\n      contentPromise = new Promise((resolve, reject) =>\r\n        fiber\r\n          ? requestIdleCallback(() => fetchAssets(src, scriptCache, fetch, false, loadError).then(resolve, reject))\r\n          : fetchAssets(src, scriptCache, fetch, false, loadError).then(resolve, reject)\r\n      );\r\n      // module || ignore\r\n    } else if ((module && src) || ignore) {\r\n      contentPromise = Promise.resolve(\"\");\r\n      // inline\r\n    } else if (!src) {\r\n      contentPromise = Promise.resolve(script.content);\r\n      // outline\r\n    } else {\r\n      contentPromise = fetchAssets(src, scriptCache, fetch, false, loadError);\r\n    }\r\n    // refer https://html.spec.whatwg.org/multipage/scripting.html#attr-script-defer\r\n    if (module && !async) script.defer = true;\r\n    return { ...script, contentPromise };\r\n  });\r\n}\r\n\r\nexport default function importHTML(params: {\r\n  url: string;\r\n  html?: string;\r\n  opts: ImportEntryOpts;\r\n}): Promise<htmlParseResult> {\r\n  const { url, opts, html } = params;\r\n  const fetch = opts.fetch ?? defaultFetch;\r\n  const fiber = opts.fiber ?? true;\r\n  const { plugins, loadError } = opts;\r\n  const htmlLoader = plugins ? compose(plugins.map((plugin) => plugin.htmlLoader)) : defaultGetTemplate;\r\n  const jsExcludes = getEffectLoaders(\"jsExcludes\", plugins);\r\n  const cssExcludes = getEffectLoaders(\"cssExcludes\", plugins);\r\n  const jsIgnores = getEffectLoaders(\"jsIgnores\", plugins);\r\n  const cssIgnores = getEffectLoaders(\"cssIgnores\", plugins);\r\n  const getPublicPath = defaultGetPublicPath;\r\n\r\n  const getHtmlParseResult = (url, html, htmlLoader) =>\r\n    (html\r\n      ? Promise.resolve(html)\r\n      : fetch(url)\r\n          .then((response) => {\r\n            if (response.status >= 400) {\r\n              error(WUJIE_TIPS_HTML_ERROR_REQUESTED, { url, response });\r\n              loadError?.(url, new Error(WUJIE_TIPS_HTML_ERROR_REQUESTED));\r\n              return \"\";\r\n            }\r\n            return response.text();\r\n          })\r\n          .catch((e) => {\r\n            embedHTMLCache[url] = null;\r\n            loadError?.(url, e);\r\n            return Promise.reject(e);\r\n          })\r\n    ).then((html) => {\r\n      const assetPublicPath = getPublicPath(url);\r\n      const { template, scripts, styles } = processTpl(htmlLoader(html), assetPublicPath);\r\n      return {\r\n        template: template,\r\n        assetPublicPath,\r\n        getExternalScripts: () =>\r\n          getExternalScripts(\r\n            scripts\r\n              .filter((script) => !script.src || !isMatchUrl(script.src, jsExcludes))\r\n              .map((script) => ({ ...script, ignore: script.src && isMatchUrl(script.src, jsIgnores) })),\r\n            fetch,\r\n            loadError,\r\n            fiber\r\n          ),\r\n        getExternalStyleSheets: () =>\r\n          getExternalStyleSheets(\r\n            styles\r\n              .filter((style) => !style.src || !isMatchUrl(style.src, cssExcludes))\r\n              .map((style) => ({ ...style, ignore: style.src && isMatchUrl(style.src, cssIgnores) })),\r\n            fetch,\r\n            loadError\r\n          ),\r\n      };\r\n    });\r\n\r\n  if (opts?.plugins.some((plugin) => plugin.htmlLoader)) {\r\n    return getHtmlParseResult(url, html, htmlLoader);\r\n    // 没有html-loader可以做缓存\r\n  } else {\r\n    return embedHTMLCache[url] || (embedHTMLCache[url] = getHtmlParseResult(url, html, htmlLoader));\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]}