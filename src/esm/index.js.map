{"version":3,"file":"index.js","names":["importHTML","processCssLoader","WuJie","defineWujieWebComponent","addLoading","processAppForHrefJump","getPlugins","wujieSupport","mergeOptions","isFunction","requestIdleCallback","isMatchSyncQueryById","warn","stopMainAppRun","getWujieById","getOptionsById","addSandboxCacheWithOptions","EventBus","WUJIE_TIPS_NOT_SUPPORTED","bus","Date","now","toString","window","__WUJIE","__POWERED_BY_WUJIE__","setupApp","options","name","startApp","_x","_startApp","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee2","startOptions","_newSandbox$lifecycle","_newSandbox$lifecycle2","sandbox","cacheOptions","url","html","replace","fetch","props","attrs","degradeAttrs","fiber","alive","degrade","sync","prefix","el","loading","plugins","lifecycles","mainHostPath","_iframeWindow","_sandbox$lifecycles3","_sandbox$lifecycles3$","_sandbox$lifecycles2","_sandbox$lifecycles2$","_yield$importHTML2","_getExternalScripts","_sandbox$lifecycles4","_sandbox$lifecycles4$","_sandbox$lifecycles5","_sandbox$lifecycles5$","newSandbox","_yield$importHTML3","template","getExternalScripts","getExternalStyleSheets","processedHtml","wrap","_callee2$","_context2","prev","next","iframeWindow","iframe","contentWindow","preload","active","execFlag","beforeLoad","call","opts","loadError","sent","start","activated","abrupt","destroy","__WUJIE_MOUNT","unmount","rebuildStyleSheets","beforeMount","afterMount","mountFlag","stop","preloadApp","preOptions","_objectSpread","exec","runPreload","_ref","_callee","_sandbox$lifecycles","_sandbox$lifecycles$b","_yield$importHTML","_callee$","_context","destroyApp","id"],"sources":["../src/index.ts"],"sourcesContent":["import importHTML, { processCssLoader } from \"./entry\";\r\nimport { StyleObject, ScriptAttributes } from \"./template\";\r\nimport WuJie, { lifecycle } from \"./sandbox\";\r\nimport { defineWujieWebComponent, addLoading } from \"./shadow\";\r\nimport { processAppForHrefJump } from \"./sync\";\r\nimport { getPlugins } from \"./plugin\";\r\nimport {\r\n  wujieSupport,\r\n  mergeOptions,\r\n  isFunction,\r\n  requestIdleCallback,\r\n  isMatchSyncQueryById,\r\n  warn,\r\n  stopMainAppRun,\r\n} from \"./utils\";\r\nimport { getWujieById, getOptionsById, addSandboxCacheWithOptions } from \"./common\";\r\nimport { EventBus } from \"./event\";\r\nimport { WUJIE_TIPS_NOT_SUPPORTED } from \"./constant\";\r\n\r\nexport const bus = new EventBus(Date.now().toString());\r\n\r\nexport interface ScriptObjectLoader {\r\n  /** 脚本地址，内联为空 */\r\n  src?: string;\r\n  /** 脚本是否为module模块 */\r\n  module?: boolean;\r\n  /** 脚本是否为async执行 */\r\n  async?: boolean;\r\n  /** 脚本是否设置crossorigin */\r\n  crossorigin?: boolean;\r\n  /** 脚本crossorigin的类型 */\r\n  crossoriginType?: \"anonymous\" | \"use-credentials\" | \"\";\r\n  /** 脚本原始属性 */\r\n  attrs?: ScriptAttributes;\r\n  /** 内联script的代码 */\r\n  content?: string;\r\n  /** 执行回调钩子 */\r\n  callback?: (appWindow: Window) => any;\r\n  /** 子应用加载完毕事件 */\r\n  onload?: Function;\r\n}\r\nexport interface plugin {\r\n  /** 处理html的loader */\r\n  htmlLoader?: (code: string) => string;\r\n  /** js排除列表 */\r\n  jsExcludes?: Array<string | RegExp>;\r\n  /** js忽略列表 */\r\n  jsIgnores?: Array<string | RegExp>;\r\n  /** 处理js加载前的loader */\r\n  jsBeforeLoaders?: Array<ScriptObjectLoader>;\r\n  /** 处理js的loader */\r\n  jsLoader?: (code: string, url: string, base: string) => string;\r\n  /** 处理js加载后的loader */\r\n  jsAfterLoaders?: Array<ScriptObjectLoader>;\r\n  /** css排除列表 */\r\n  cssExcludes?: Array<string | RegExp>;\r\n  /** css忽略列表 */\r\n  cssIgnores?: Array<string | RegExp>;\r\n  /** 处理css加载前的loader */\r\n  cssBeforeLoaders?: Array<StyleObject>;\r\n  /** 处理css的loader */\r\n  cssLoader?: (code: string, url: string, base: string) => string;\r\n  /** 处理css加载后的loader */\r\n  cssAfterLoaders?: Array<StyleObject>;\r\n  /** 子应用 window addEventListener 钩子回调 */\r\n  windowAddEventListenerHook?: eventListenerHook;\r\n  /** 子应用 window removeEventListener 钩子回调 */\r\n  windowRemoveEventListenerHook?: eventListenerHook;\r\n  /** 子应用 document addEventListener 钩子回调 */\r\n  documentAddEventListenerHook?: eventListenerHook;\r\n  /** 子应用 document removeEventListener 钩子回调 */\r\n  documentRemoveEventListenerHook?: eventListenerHook;\r\n  /** 子应用 向body、head插入元素后执行的钩子回调 */\r\n  appendOrInsertElementHook?: <T extends Node>(element: T, iframeWindow: Window) => void;\r\n  /** 子应用劫持元素的钩子回调 */\r\n  patchElementHook?: <T extends Node>(element: T, iframeWindow: Window) => void;\r\n  /** 用户自定义覆盖子应用 window 属性 */\r\n  windowPropertyOverride?: (iframeWindow: Window) => void;\r\n  /** 用户自定义覆盖子应用 document 属性 */\r\n  documentPropertyOverride?: (iframeWindow: Window) => void;\r\n}\r\n\r\ntype eventListenerHook = (\r\n  iframeWindow: Window,\r\n  type: string,\r\n  handler: EventListenerOrEventListenerObject,\r\n  options?: boolean | AddEventListenerOptions\r\n) => void;\r\n\r\nexport type loadErrorHandler = (url: string, e: Error) => any;\r\n\r\ntype baseOptions = {\r\n  /** 唯一性用户必须保证 */\r\n  name: string;\r\n  /** 需要渲染的url */\r\n  url: string;\r\n  /** 需要渲染的html, 如果已有则无需从url请求 */\r\n  html?: string;\r\n  /** 代码替换钩子 */\r\n  replace?: (code: string) => string;\r\n  /** 自定义fetch */\r\n  fetch?: (input: RequestInfo, init?: RequestInit) => Promise<Response>;\r\n  /** 注入给子应用的属性 */\r\n  props?: { [key: string]: any };\r\n  /** 自定义运行iframe的属性 */\r\n  attrs?: { [key: string]: any };\r\n  /** 自定义降级渲染iframe的属性 */\r\n  degradeAttrs?: { [key: string]: any };\r\n  /** 子应用采用fiber模式执行 */\r\n  fiber?: boolean;\r\n  /** 子应用保活，state不会丢失 */\r\n  alive?: boolean;\r\n  /** 子应用采用降级iframe方案 */\r\n  degrade?: boolean;\r\n  /** 子应用插件 */\r\n  plugins?: Array<plugin>;\r\n  /** 自定义沙箱 iframe src */\r\n  mainHostPath?: string;\r\n  /** 子应用生命周期 */\r\n  beforeLoad?: lifecycle;\r\n  beforeMount?: lifecycle;\r\n  afterMount?: lifecycle;\r\n  beforeUnmount?: lifecycle;\r\n  afterUnmount?: lifecycle;\r\n  activated?: lifecycle;\r\n  deactivated?: lifecycle;\r\n  loadError?: loadErrorHandler;\r\n};\r\n\r\nexport type preOptions = baseOptions & {\r\n  /** 预执行 */\r\n  exec?: boolean;\r\n};\r\n\r\nexport type startOptions = baseOptions & {\r\n  /** 渲染的容器 */\r\n  el: HTMLElement | string;\r\n  /**\r\n   * 路由同步开关\r\n   * 如果false，子应用跳转主应用路由无变化，但是主应用的history还是会增加\r\n   * https://html.spec.whatwg.org/multipage/history.html#the-history-interface\r\n   */\r\n  sync?: boolean;\r\n  /** 子应用短路径替换，路由同步时生效 */\r\n  prefix?: { [key: string]: string };\r\n  /** 子应用加载时loading元素 */\r\n  loading?: HTMLElement;\r\n};\r\n\r\ntype optionProperty = \"url\" | \"el\";\r\n\r\n/**\r\n * 合并 preOptions 和 startOptions，并且将 url 和 el 变成可选\r\n */\r\nexport type cacheOptions = Omit<preOptions & startOptions, optionProperty> &\r\n  Partial<Pick<startOptions, optionProperty>>;\r\n\r\n/**\r\n * 强制中断主应用运行\r\n * wujie.__WUJIE 如果为true说明当前运行环境是子应用\r\n * window.__POWERED_BY_WUJIE__ 如果为false说明子应用还没初始化完成\r\n * 上述条件同时成立说明主应用代码在iframe的loading阶段混入进来了，必须中断执行\r\n */\r\nif (window.__WUJIE && !window.__POWERED_BY_WUJIE__) {\r\n  stopMainAppRun();\r\n}\r\n\r\n// 处理子应用链接跳转\r\nprocessAppForHrefJump();\r\n\r\n// 定义webComponent容器\r\ndefineWujieWebComponent();\r\n\r\n// 如果不支持则告警\r\nif (!wujieSupport) warn(WUJIE_TIPS_NOT_SUPPORTED);\r\n\r\n/**\r\n * 缓存子应用配置\r\n */\r\nexport function setupApp(options: cacheOptions): void {\r\n  if (options.name) addSandboxCacheWithOptions(options.name, options);\r\n}\r\n\r\n/**\r\n * 运行无界app\r\n */\r\nexport async function startApp(startOptions: startOptions): Promise<Function | void> {\r\n  const sandbox = getWujieById(startOptions.name);\r\n  const cacheOptions = getOptionsById(startOptions.name);\r\n  // 合并缓存配置\r\n  const options = mergeOptions(startOptions, cacheOptions);\r\n  const {\r\n    name,\r\n    url,\r\n    html,\r\n    replace,\r\n    fetch,\r\n    props,\r\n    attrs,\r\n    degradeAttrs,\r\n    fiber,\r\n    alive,\r\n    degrade,\r\n    sync,\r\n    prefix,\r\n    el,\r\n    loading,\r\n    plugins,\r\n    lifecycles,\r\n    mainHostPath,\r\n  } = options;\r\n  // 已经初始化过的应用，快速渲染\r\n  if (sandbox) {\r\n    sandbox.plugins = getPlugins(plugins);\r\n    sandbox.lifecycles = lifecycles;\r\n    const iframeWindow = sandbox.iframe.contentWindow;\r\n    if (sandbox.preload) {\r\n      await sandbox.preload;\r\n    }\r\n    if (alive) {\r\n      // 保活\r\n      await sandbox.active({ url, sync, prefix, el, props, alive, fetch, replace });\r\n      // 预加载但是没有执行的情况\r\n      if (!sandbox.execFlag) {\r\n        sandbox.lifecycles?.beforeLoad?.(sandbox.iframe.contentWindow);\r\n        const { getExternalScripts } = await importHTML({\r\n          url,\r\n          html,\r\n          opts: {\r\n            fetch: fetch || window.fetch,\r\n            plugins: sandbox.plugins,\r\n            loadError: sandbox.lifecycles.loadError,\r\n            fiber,\r\n          },\r\n        });\r\n        await sandbox.start(getExternalScripts);\r\n      }\r\n      sandbox.lifecycles?.activated?.(sandbox.iframe.contentWindow);\r\n      return sandbox.destroy;\r\n    } else if (isFunction(iframeWindow.__WUJIE_MOUNT)) {\r\n      /**\r\n       * 子应用切换会触发webcomponent的disconnectedCallback调用sandbox.unmount进行实例销毁\r\n       * 此处是防止没有销毁webcomponent时调用startApp的情况，需要手动调用unmount\r\n       */\r\n      sandbox.unmount();\r\n      await sandbox.active({ url, sync, prefix, el, props, alive, fetch, replace });\r\n      // 正常加载的情况，先注入css，最后才mount。重新激活也保持同样的时序\r\n      sandbox.rebuildStyleSheets();\r\n      // 有渲染函数\r\n      sandbox.lifecycles?.beforeMount?.(sandbox.iframe.contentWindow);\r\n      iframeWindow.__WUJIE_MOUNT();\r\n      sandbox.lifecycles?.afterMount?.(sandbox.iframe.contentWindow);\r\n      sandbox.mountFlag = true;\r\n      return sandbox.destroy;\r\n    } else {\r\n      // 没有渲染函数\r\n      sandbox.destroy();\r\n    }\r\n  }\r\n\r\n  // 设置loading\r\n  addLoading(el, loading);\r\n  const newSandbox = new WuJie({ name, url, attrs, degradeAttrs, fiber, degrade, plugins, lifecycles, mainHostPath });\r\n  newSandbox.lifecycles?.beforeLoad?.(newSandbox.iframe.contentWindow);\r\n  const { template, getExternalScripts, getExternalStyleSheets } = await importHTML({\r\n    url,\r\n    html,\r\n    opts: {\r\n      fetch: fetch || window.fetch,\r\n      plugins: newSandbox.plugins,\r\n      loadError: newSandbox.lifecycles.loadError,\r\n      fiber,\r\n    },\r\n  });\r\n\r\n  const processedHtml = await processCssLoader(newSandbox, template, getExternalStyleSheets);\r\n  await newSandbox.active({ url, sync, prefix, template: processedHtml, el, props, alive, fetch, replace });\r\n  await newSandbox.start(getExternalScripts);\r\n  return newSandbox.destroy;\r\n}\r\n\r\n/**\r\n * 预加载无界APP\r\n */\r\nexport function preloadApp(preOptions: preOptions): void {\r\n  requestIdleCallback((): void | Promise<void> => {\r\n    /**\r\n     * 已经存在\r\n     * url查询参数中有子应用的id，大概率是刷新浏览器或者分享url，此时需要直接打开子应用，无需预加载\r\n     */\r\n    if (getWujieById(preOptions.name) || isMatchSyncQueryById(preOptions.name)) return;\r\n    const cacheOptions = getOptionsById(preOptions.name);\r\n    // 合并缓存配置\r\n    const options = mergeOptions({ ...preOptions }, cacheOptions);\r\n    const {\r\n      name,\r\n      url,\r\n      html,\r\n      props,\r\n      alive,\r\n      replace,\r\n      fetch,\r\n      exec,\r\n      attrs,\r\n      degradeAttrs,\r\n      fiber,\r\n      degrade,\r\n      prefix,\r\n      plugins,\r\n      lifecycles,\r\n      mainHostPath,\r\n    } = options;\r\n\r\n    const sandbox = new WuJie({ name, url, attrs, degradeAttrs, fiber, degrade, plugins, lifecycles, mainHostPath });\r\n    if (sandbox.preload) return sandbox.preload;\r\n    const runPreload = async () => {\r\n      sandbox.lifecycles?.beforeLoad?.(sandbox.iframe.contentWindow);\r\n      const { template, getExternalScripts, getExternalStyleSheets } = await importHTML({\r\n        url,\r\n        html,\r\n        opts: {\r\n          fetch: fetch || window.fetch,\r\n          plugins: sandbox.plugins,\r\n          loadError: sandbox.lifecycles.loadError,\r\n          fiber,\r\n        },\r\n      });\r\n      const processedHtml = await processCssLoader(sandbox, template, getExternalStyleSheets);\r\n      await sandbox.active({ url, props, prefix, alive, template: processedHtml, fetch, replace });\r\n      if (exec) {\r\n        await sandbox.start(getExternalScripts);\r\n      } else {\r\n        await getExternalScripts();\r\n      }\r\n    };\r\n    sandbox.preload = runPreload();\r\n  });\r\n}\r\n\r\n/**\r\n * 销毁无界APP\r\n */\r\nexport function destroyApp(id: string): void {\r\n  const sandbox = getWujieById(id);\r\n  if (sandbox) {\r\n    sandbox.destroy();\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]}