{"version":3,"file":"template.js","names":["getInlineCode","ALL_SCRIPT_REGEX","SCRIPT_TAG_REGEX","SCRIPT_SRC_REGEX","SCRIPT_TYPE_REGEX","SCRIPT_ENTRY_REGEX","SCRIPT_ASYNC_REGEX","DEFER_ASYNC_REGEX","SCRIPT_NO_MODULE_REGEX","SCRIPT_MODULE_REGEX","LINK_TAG_REGEX","LINK_PRELOAD_OR_PREFETCH_REGEX","LINK_HREF_REGEX","LINK_AS_FONT","STYLE_TAG_REGEX","STYLE_TYPE_REGEX","STYLE_HREF_REGEX","HTML_COMMENT_REGEX","LINK_IGNORE_REGEX","STYLE_IGNORE_REGEX","SCRIPT_IGNORE_REGEX","CROSS_ORIGIN_REGEX","hasProtocol","url","startsWith","getEntirePath","path","baseURI","URL","toString","isValidJavaScriptType","type","handleTypes","indexOf","parseTagAttributes","TagOuterHTML","pattern","matches","exec","attributesString","attributesPattern","attributesObject","attributeMatches","attributeName","attributeValue","isModuleScriptSupported","s","window","document","createElement","genLinkReplaceSymbol","linkHref","preloadOrPrefetch","arguments","length","undefined","concat","getInlineStyleReplaceSymbol","index","genScriptReplaceSymbol","scriptSrc","inlineScriptReplaceSymbol","genIgnoreAssetReplaceSymbol","genModuleScriptReplaceSymbol","moduleSupport","processTpl","tpl","postProcessTemplate","scripts","styles","entry","template","replace","match","styleType","styleHref","styleIgnore","href","newHref","push","src","preloadOrPrefetchType","_match$match","_match$match2","_slicedToArray","test","code","content","scriptTag","scriptIgnore","isModuleScript","isCrossOriginScript","crossOriginType","moduleScriptIgnore","matchedScriptTypeMatch","matchedScriptType","matchedScriptEntry","matchedScriptSrcMatch","matchedScriptSrc","SyntaxError","isAsyncScript","isDeferScript","async","defer","module","crossorigin","crossoriginType","attrs","isPureCommentBlock","split","every","line","trim","tplResult"],"sources":["../src/template.ts"],"sourcesContent":["import { getInlineCode } from \"./utils\";\r\n\r\nconst ALL_SCRIPT_REGEX = /(<script[\\s\\S]*?>)[\\s\\S]*?<\\/script>/gi;\r\nconst SCRIPT_TAG_REGEX = /<(script)\\s+((?!type=('|\")text\\/ng-template\\3).)*?>.*?<\\/\\1>/is;\r\nconst SCRIPT_SRC_REGEX = /.*\\ssrc=('|\")?([^>'\"\\s]+)/;\r\nconst SCRIPT_TYPE_REGEX = /.*\\stype=('|\")?([^>'\"\\s]+)/;\r\nconst SCRIPT_ENTRY_REGEX = /.*\\sentry\\s*.*/;\r\nconst SCRIPT_ASYNC_REGEX = /.*\\sasync\\s*.*/;\r\nconst DEFER_ASYNC_REGEX = /.*\\sdefer\\s*.*/;\r\nconst SCRIPT_NO_MODULE_REGEX = /.*\\snomodule\\s*.*/;\r\nconst SCRIPT_MODULE_REGEX = /.*\\stype=('|\")?module('|\")?\\s*.*/;\r\nconst LINK_TAG_REGEX = /<(link)\\s+.*?>/gis;\r\nconst LINK_PRELOAD_OR_PREFETCH_REGEX = /\\srel=('|\")?(preload|prefetch|modulepreload)\\1/;\r\nconst LINK_HREF_REGEX = /.*\\shref=('|\")?([^>'\"\\s]+)/;\r\nconst LINK_AS_FONT = /.*\\sas=('|\")?font\\1.*/;\r\nconst STYLE_TAG_REGEX = /<style[^>]*>[\\s\\S]*?<\\/style>/gi;\r\nconst STYLE_TYPE_REGEX = /\\s+rel=('|\")?stylesheet\\1.*/;\r\nconst STYLE_HREF_REGEX = /.*\\shref=('|\")?([^>'\"\\s]+)/;\r\nconst HTML_COMMENT_REGEX = /<!--([\\s\\S]*?)-->/g;\r\nconst LINK_IGNORE_REGEX = /<link(\\s+|\\s+.+\\s+)ignore(\\s*|\\s+.*|=.*)>/is;\r\nconst STYLE_IGNORE_REGEX = /<style(\\s+|\\s+.+\\s+)ignore(\\s*|\\s+.*|=.*)>/is;\r\nconst SCRIPT_IGNORE_REGEX = /<script(\\s+|\\s+.+\\s+)ignore(\\s*|\\s+.*|=.*)>/is;\r\nconst CROSS_ORIGIN_REGEX = /.*\\scrossorigin=?('|\")?(use-credentials|anonymous)?('|\")?/i;\r\n\r\nexport type ScriptAttributes = {\r\n  [key: string]: string | boolean; // 所有属性都可以是字符串或布尔值类型\r\n};\r\n/** 脚本对象 */\r\nexport interface ScriptBaseObject {\r\n  /** 脚本地址，内联为空 */\r\n  src?: string;\r\n  /** 脚本是否为async执行 */\r\n  async?: boolean;\r\n  /** 脚本是否为defer执行 */\r\n  defer?: boolean;\r\n  /** 脚本是否为module模块 */\r\n  module?: boolean;\r\n  /** 脚本是否设置crossorigin */\r\n  crossorigin?: boolean;\r\n  /** 脚本crossorigin的类型 */\r\n  crossoriginType?: \"anonymous\" | \"use-credentials\" | \"\";\r\n  /** 脚本正则匹配属性 */\r\n  attrs?: ScriptAttributes;\r\n}\r\nexport type ScriptObject = ScriptBaseObject & {\r\n  /** 内联script的代码 */\r\n  content?: string;\r\n  /** 忽略，子应用自行请求 */\r\n  ignore?: boolean;\r\n  /** 子应用加载完毕事件 */\r\n  onload?: Function;\r\n};\r\n\r\n/** 样式对象 */\r\nexport interface StyleObject {\r\n  /** 样式地址， 内联为空 */\r\n  src?: string;\r\n  /** 样式代码 */\r\n  content?: string;\r\n  /** 忽略，子应用自行请求 */\r\n  ignore?: boolean;\r\n}\r\n\r\nexport interface TemplateResult {\r\n  template: string;\r\n  scripts: ScriptObject[];\r\n  styles: StyleObject[];\r\n  entry: string | ScriptObject;\r\n}\r\n\r\nfunction hasProtocol(url) {\r\n  return url.startsWith(\"//\") || url.startsWith(\"http://\") || url.startsWith(\"https://\");\r\n}\r\n\r\nfunction getEntirePath(path, baseURI) {\r\n  return new URL(path, baseURI).toString();\r\n}\r\n\r\nfunction isValidJavaScriptType(type) {\r\n  const handleTypes = [\r\n    \"text/javascript\",\r\n    \"module\",\r\n    \"application/javascript\",\r\n    \"text/ecmascript\",\r\n    \"application/ecmascript\",\r\n  ];\r\n  return !type || handleTypes.indexOf(type) !== -1;\r\n}\r\n\r\n/**\r\n * 解析标签的属性\r\n * @param scriptOuterHTML script 标签的 outerHTML\r\n * @returns 返回一个对象，包含 script 标签的所有属性\r\n */\r\nexport function parseTagAttributes(TagOuterHTML) {\r\n  const pattern = /<[-\\w]+\\s+([^>]*)>/i;\r\n  const matches = pattern.exec(TagOuterHTML);\r\n\r\n  if (!matches) {\r\n    return {};\r\n  }\r\n\r\n  const attributesString = matches[1];\r\n  const attributesPattern = /([^\\s=]+)\\s*=\\s*(['\"])(.*?)\\2/g;\r\n  const attributesObject = {};\r\n\r\n  let attributeMatches;\r\n  while ((attributeMatches = attributesPattern.exec(attributesString)) !== null) {\r\n    const attributeName = attributeMatches[1];\r\n    const attributeValue = attributeMatches[3];\r\n    attributesObject[attributeName] = attributeValue;\r\n  }\r\n\r\n  return attributesObject;\r\n}\r\n\r\nfunction isModuleScriptSupported() {\r\n  const s = window.document.createElement(\"script\");\r\n  return \"noModule\" in s;\r\n}\r\n\r\nexport const genLinkReplaceSymbol = (linkHref, preloadOrPrefetch = false) =>\r\n  `<!-- ${preloadOrPrefetch ? \"prefetch/preload/modulepreload\" : \"\"} link ${linkHref} replaced by wujie -->`;\r\nexport const getInlineStyleReplaceSymbol = (index) => `<!-- inline-style-${index} replaced by wujie -->`;\r\nexport const genScriptReplaceSymbol = (scriptSrc, type = \"\") =>\r\n  `<!-- ${type} script ${scriptSrc} replaced by wujie -->`;\r\nexport const inlineScriptReplaceSymbol = \"<!-- inline scripts replaced by wujie -->\";\r\nexport const genIgnoreAssetReplaceSymbol = (url) => `<!-- ignore asset ${url || \"file\"} replaced by wujie -->`;\r\nexport const genModuleScriptReplaceSymbol = (scriptSrc, moduleSupport) =>\r\n  `<!-- ${moduleSupport ? \"nomodule\" : \"module\"} script ${scriptSrc} ignored by wujie -->`;\r\n\r\n/**\r\n * parse the script link from the template\r\n * 1. collect stylesheets\r\n * 2. use global eval to evaluate the inline scripts\r\n *    see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function#Difference_between_Function_constructor_and_function_declaration\r\n *    see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/eval#Do_not_ever_use_eval!\r\n * @param tpl\r\n * @param baseURI\r\n * @stripStyles whether to strip the css links\r\n * @returns {{template: void | string | *, scripts: *[], entry: *}}\r\n */\r\nexport default function processTpl(tpl: String, baseURI: String, postProcessTemplate?: Function): TemplateResult {\r\n  const scripts: ScriptObject[] = [];\r\n  const styles: StyleObject[] = [];\r\n  let entry = null;\r\n  const moduleSupport = isModuleScriptSupported();\r\n  const template = tpl\r\n\r\n    /*\r\n     remove html comment first\r\n     */\r\n    .replace(HTML_COMMENT_REGEX, \"\")\r\n\r\n    .replace(LINK_TAG_REGEX, (match) => {\r\n      /*\r\n       change the css link\r\n       */\r\n      const styleType = !!match.match(STYLE_TYPE_REGEX);\r\n      if (styleType) {\r\n        const styleHref = match.match(STYLE_HREF_REGEX);\r\n        const styleIgnore = match.match(LINK_IGNORE_REGEX);\r\n\r\n        if (styleHref) {\r\n          const href = styleHref && styleHref[2];\r\n          let newHref = href;\r\n\r\n          if (href && !hasProtocol(href)) {\r\n            newHref = getEntirePath(href, baseURI);\r\n          }\r\n          if (styleIgnore) {\r\n            return genIgnoreAssetReplaceSymbol(newHref);\r\n          }\r\n\r\n          styles.push({ src: newHref });\r\n          return genLinkReplaceSymbol(newHref);\r\n        }\r\n      }\r\n\r\n      const preloadOrPrefetchType =\r\n        match.match(LINK_PRELOAD_OR_PREFETCH_REGEX) && match.match(LINK_HREF_REGEX) && !match.match(LINK_AS_FONT);\r\n      if (preloadOrPrefetchType) {\r\n        const [, , linkHref] = match.match(LINK_HREF_REGEX);\r\n        return genLinkReplaceSymbol(linkHref, true);\r\n      }\r\n\r\n      return match;\r\n    })\r\n    .replace(STYLE_TAG_REGEX, (match) => {\r\n      if (STYLE_IGNORE_REGEX.test(match)) {\r\n        return genIgnoreAssetReplaceSymbol(\"style file\");\r\n      } else {\r\n        const code = getInlineCode(match);\r\n        styles.push({ src: \"\", content: code });\r\n        return getInlineStyleReplaceSymbol(styles.length - 1);\r\n      }\r\n    })\r\n    .replace(ALL_SCRIPT_REGEX, (match, scriptTag) => {\r\n      const scriptIgnore = scriptTag.match(SCRIPT_IGNORE_REGEX);\r\n      const isModuleScript = !!scriptTag.match(SCRIPT_MODULE_REGEX);\r\n      const isCrossOriginScript = scriptTag.match(CROSS_ORIGIN_REGEX);\r\n      const crossOriginType = isCrossOriginScript?.[2] || \"\";\r\n      const moduleScriptIgnore =\r\n        (moduleSupport && !!scriptTag.match(SCRIPT_NO_MODULE_REGEX)) || (!moduleSupport && isModuleScript);\r\n      // in order to keep the exec order of all javascripts\r\n\r\n      const matchedScriptTypeMatch = scriptTag.match(SCRIPT_TYPE_REGEX);\r\n      const matchedScriptType = matchedScriptTypeMatch && matchedScriptTypeMatch[2];\r\n      if (!isValidJavaScriptType(matchedScriptType)) {\r\n        return match;\r\n      }\r\n\r\n      // if it is a external script\r\n      if (SCRIPT_TAG_REGEX.test(match) && scriptTag.match(SCRIPT_SRC_REGEX)) {\r\n        /*\r\n         collect scripts and replace the ref\r\n         */\r\n\r\n        const matchedScriptEntry = scriptTag.match(SCRIPT_ENTRY_REGEX);\r\n        const matchedScriptSrcMatch = scriptTag.match(SCRIPT_SRC_REGEX);\r\n        let matchedScriptSrc = matchedScriptSrcMatch && matchedScriptSrcMatch[2];\r\n\r\n        if (entry && matchedScriptEntry) {\r\n          throw new SyntaxError(\"You should not set multiply entry script!\");\r\n        } else {\r\n          // append the domain while the script not have an protocol prefix\r\n          if (matchedScriptSrc && !hasProtocol(matchedScriptSrc)) {\r\n            matchedScriptSrc = getEntirePath(matchedScriptSrc, baseURI);\r\n          }\r\n\r\n          entry = entry || (matchedScriptEntry && matchedScriptSrc);\r\n        }\r\n\r\n        if (scriptIgnore) {\r\n          return genIgnoreAssetReplaceSymbol(matchedScriptSrc || \"js file\");\r\n        }\r\n\r\n        if (moduleScriptIgnore) {\r\n          return genModuleScriptReplaceSymbol(matchedScriptSrc || \"js file\", moduleSupport);\r\n        }\r\n\r\n        if (matchedScriptSrc) {\r\n          const isAsyncScript = !!scriptTag.match(SCRIPT_ASYNC_REGEX);\r\n          const isDeferScript = !!scriptTag.match(DEFER_ASYNC_REGEX);\r\n          scripts.push(\r\n            isAsyncScript || isDeferScript\r\n              ? {\r\n                  async: isAsyncScript,\r\n                  defer: isDeferScript,\r\n                  src: matchedScriptSrc,\r\n                  module: isModuleScript,\r\n                  crossorigin: !!isCrossOriginScript,\r\n                  crossoriginType: crossOriginType,\r\n                  attrs: parseTagAttributes(match),\r\n                }\r\n              : {\r\n                  src: matchedScriptSrc,\r\n                  module: isModuleScript,\r\n                  crossorigin: !!isCrossOriginScript,\r\n                  crossoriginType: crossOriginType,\r\n                  attrs: parseTagAttributes(match),\r\n                }\r\n          );\r\n          return genScriptReplaceSymbol(\r\n            matchedScriptSrc,\r\n            (isAsyncScript && \"async\") || (isDeferScript && \"defer\") || \"\"\r\n          );\r\n        }\r\n\r\n        return match;\r\n      } else {\r\n        if (scriptIgnore) {\r\n          return genIgnoreAssetReplaceSymbol(\"js file\");\r\n        }\r\n\r\n        if (moduleScriptIgnore) {\r\n          return genModuleScriptReplaceSymbol(\"js file\", moduleSupport);\r\n        }\r\n\r\n        // if it is an inline script\r\n        const code = getInlineCode(match);\r\n\r\n        // remove script blocks when all of these lines are comments.\r\n        const isPureCommentBlock = code.split(/[\\r\\n]+/).every((line) => !line.trim() || line.trim().startsWith(\"//\"));\r\n\r\n        if (!isPureCommentBlock && code) {\r\n          scripts.push({\r\n            src: \"\",\r\n            content: code,\r\n            module: isModuleScript,\r\n            crossorigin: !!isCrossOriginScript,\r\n            crossoriginType: crossOriginType,\r\n            attrs: parseTagAttributes(match),\r\n          });\r\n        }\r\n\r\n        return inlineScriptReplaceSymbol;\r\n      }\r\n    });\r\n\r\n  let tplResult = {\r\n    template,\r\n    scripts,\r\n    styles,\r\n    // set the last script as entry if have not set\r\n    entry: entry || scripts[scripts.length - 1],\r\n  };\r\n  if (typeof postProcessTemplate === \"function\") {\r\n    tplResult = postProcessTemplate(tplResult);\r\n  }\r\n\r\n  return tplResult;\r\n}\r\n"],"mappings":"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","ignoreList":[]}