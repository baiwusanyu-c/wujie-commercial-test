import{d as B,r as y,b as J,c as u,z as I,o as x,k as E,w as t,f as C,g as e,j as g,A as R,B as z,E as K,G as X,a as Y,e as S,q as w,C as Z}from"./index-3e61b4b7.js";import{u as h,g as ee,a as le,e as ae,b as te}from"./upload-d90172a6.js";const oe={class:"dialog-footer"},ne=B({__name:"upload-save",props:{modalTitle:{},editData:{},requestApi:{}},emits:["close"],setup(M,{emit:_}){var p;const q=M,f=_,r=(p=z())==null?void 0:p.proxy,v=y(!1),d=y(),n=J(q.editData),N={tableName:[{required:!0,message:"请输入表名称"}],classification:[{required:!0,message:"请输入分类"}],tableNa:[{required:!0,message:"请输入表名"}],dataSource:[{required:!0,message:"请选择数据源"}],tableType:[{required:!0,message:"请选择表类型"}],tableCode:[{required:!0,message:"请输入业务建表语句"}]},V=(a=!1)=>{f("close",a)},T=a=>{a&&a.validate(o=>{o&&(v.value=!0,q.requestApi(n).then(({msg:k})=>{r==null||r.$message.success(k??"操作成功"),V(!0)}).finally(()=>{v.value=!1}))})};return(a,o)=>{const k=u("el-input"),c=u("el-form-item"),m=u("el-option"),U=u("el-select"),F=u("el-form"),b=u("el-button"),l=u("el-dialog"),L=I("loading");return x(),E(l,{title:a.modalTitle,"model-value":!0,width:"45%","close-on-click-modal":!1,"before-close":()=>V()},{footer:t(()=>[C("span",oe,[e(b,{loading:v.value,onClick:o[6]||(o[6]=s=>V())},{default:t(()=>o[9]||(o[9]=[g("取消")])),_:1},8,["loading"]),e(b,{loading:v.value,type:"primary",onClick:o[7]||(o[7]=s=>T(d.value))},{default:t(()=>o[10]||(o[10]=[g(" 提交 ")])),_:1},8,["loading"])])]),default:t(()=>[R((x(),E(F,{ref_key:"ruleFormRef",ref:d,model:n,rules:N,"label-width":"auto","label-position":"right"},{default:t(()=>[e(c,{prop:"tableName",label:"表名称"},{default:t(()=>[e(k,{modelValue:n.tableName,"onUpdate:modelValue":o[0]||(o[0]=s=>n.tableName=s),modelModifiers:{trim:!0},placeholder:"请输入表名称"},null,8,["modelValue"])]),_:1}),e(c,{prop:"classification",label:"分类"},{default:t(()=>[e(k,{modelValue:n.classification,"onUpdate:modelValue":o[1]||(o[1]=s=>n.classification=s),modelModifiers:{trim:!0},placeholder:"请输入分类"},null,8,["modelValue"])]),_:1}),e(c,{prop:"tableNa",label:"表名"},{default:t(()=>[e(k,{modelValue:n.tableNa,"onUpdate:modelValue":o[2]||(o[2]=s=>n.tableNa=s),modelModifiers:{trim:!0},placeholder:"请输入表名"},null,8,["modelValue"])]),_:1}),e(c,{prop:"dataSource",label:"数据源"},{default:t(()=>[e(U,{modelValue:n.dataSource,"onUpdate:modelValue":o[3]||(o[3]=s=>n.dataSource=s),placeholder:"请选择数据源",clearable:""},{default:t(()=>[e(m,{label:"文件上传数据源【统一源】",value:"1"}),e(m,{label:"文件上传数据源【1】",value:"2"}),e(m,{label:"文件上传数据源【2】",value:"3"}),e(m,{label:"文件上传数据源【3】",value:"4"})]),_:1},8,["modelValue"])]),_:1}),e(c,{prop:"tableType",label:"表类型"},{default:t(()=>[e(U,{modelValue:n.tableType,"onUpdate:modelValue":o[4]||(o[4]=s=>n.tableType=s),placeholder:"请选择表类型",clearable:""},{default:t(()=>[e(m,{label:"全量表",value:"1"}),e(m,{label:"增量表",value:"2"})]),_:1},8,["modelValue"])]),_:1}),e(c,{prop:"tableCode",label:"业务建表语句"},{default:t(()=>[e(k,{modelValue:n.tableCode,"onUpdate:modelValue":o[5]||(o[5]=s=>n.tableCode=s),modelModifiers:{trim:!0},type:"textarea",rows:6,placeholder:"请输入业务建表语句"},null,8,["modelValue"]),o[8]||(o[8]=C("span",{class:"color-#F53F3F text-12px"},'注息:"业务建表语句“中包建的表名称需与表名”中所站写表名称保持一致',-1))]),_:1})]),_:1},8,["model"])),[[L,v.value]])]),_:1},8,["title","before-close"])}}}),ie={class:"flex flex-col items-center justify-center"},se={class:"flex items-center"},ue=B({__name:"upload-file",props:{modalTitle:{},editData:{}},emits:["close"],setup(M,{emit:_}){var T;const q=M,f=_,r=(T=z())==null?void 0:T.proxy,v=y(!1),d=y([]),n=(p=!1)=>{f("close",p)},N=()=>{if(d.value.length===0)return r==null?void 0:r.$message.warning("请选择上传文件！");v.value=!0;const p=d.value.map(a=>({...a,id:q.editData.id}));h(p).then(({msg:a})=>{r==null||r.$message.success(a??"操作成功"),n(!0)}).finally(()=>{v.value=!1})},V=async()=>{const p=await K("crowd_package_template");p.data&&X(`https://cbd-bigdata.oss-cn-hangzhou.aliyuncs.com/${p.data}`)};return(p,a)=>{const o=u("ly-svg-icon"),k=u("LyUpload"),c=u("el-button"),m=u("el-dialog");return x(),E(m,{title:p.modalTitle,"model-value":!0,width:"50%","close-on-click-modal":!1,"before-close":()=>n()},{footer:t(()=>[C("span",se,[e(c,{type:"primary",plain:"",onClick:V},{default:t(()=>a[3]||(a[3]=[g("下载模板")])),_:1}),e(c,{class:"mlauto!",loading:v.value,onClick:a[1]||(a[1]=U=>n())},{default:t(()=>a[4]||(a[4]=[g("取消")])),_:1},8,["loading"]),e(c,{loading:v.value,type:"primary",onClick:N},{default:t(()=>a[5]||(a[5]=[g(" 提交 ")])),_:1},8,["loading"])])]),default:t(()=>[e(k,{drag:"",modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=U=>d.value=U)},{trigger:t(()=>[C("div",ie,[e(o,{class:"w40px! h40px! mb16px","icon-class":"upload"}),a[2]||(a[2]=C("span",{class:"color-#1D2129"},[g("将文件拖拽至此区域 或 "),C("span",{class:"color-main"},"选择文件")],-1))])]),_:1},8,["modelValue"]),a[6]||(a[6]=C("div",{class:"line-height-22px mb8px"},"导入文件须知：",-1)),a[7]||(a[7]=C("div",{class:"color-#86909C text-14px line-height-24px"},"1.文件类型:Excel格式",-1)),a[8]||(a[8]=C("div",{class:"color-#86909C text-14px line-height-24px"},"2.文件大小限制:不得超过100w行",-1)),a[9]||(a[9]=C("div",{class:"color-#86909C text-14px line-height-24px"},"3.文件不支持表格合并",-1)),a[10]||(a[10]=C("div",{class:"color-#86909C text-14px line-height-24px"},"4.确认上传文件表头是否与模版一致",-1)),a[11]||(a[11]=C("div",{class:"color-#86909C text-14px line-height-24px"},"5.表格应为纯数值，不能带有“元”，“万”等单位",-1))]),_:1},8,["title","before-close"])}}}),de={key:0},re={key:1},pe=B({name:"internal-menu"}),ve=B({...pe,setup(M){var F;const _=(F=z())==null?void 0:F.proxy,q=Y(),f=y({classification:"",tableName:"",tableNa:"",tableType:""}),r=y(!1),v=y([]),d=y({pageSize:10,pageNo:1,total:0}),n=y({}),N=y(!1),V=y(),T=y(),p=()=>{d.value={pageSize:10,pageNo:1,total:0}},a=()=>{r.value=!0,ee({...f.value,...d.value}).then(b=>{d.value.total=b.data.totalNumber,v.value=b.data.list}).finally(()=>{r.value=!1})};a();function o(){p(),v.value=[],a()}function k(){_==null||_.$resetForm("queryRef"),p(),a()}const c=y(!1),m=(b,l)=>{if(b==="add"){N.value=!0,V.value="新建表",n.value={tableCode:`CREATE TABLE data_example (
        data_example_name varchar(32) DEFAULT NULL COMMENT '样例字段名称',
        data_example_type varchar(32) DEFAULT NULL COMMENT '样例类型',
        create_person varchar(32) DEFAULT NULL COMMENT '创建人',
        update_person varchar(32) DEFAULT NULL COMMENT '更新人'
      ) ENGINE=InnoDB COMMENT='样例表';`},T.value=le;return}if(b==="edit"&&l){N.value=!0,V.value="编辑表",T.value=ae,n.value={...l};return}if(b==="upload"&&l){c.value=!0,V.value="上传文件",n.value={...l};return}if(b==="delete"&&l){_==null||_.$messageBox.confirm("是否确定删除","删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",callback(L){L==="confirm"&&te(l).then(({msg:s})=>{a(),_==null||_.$message.success(s??"删除成功")})}});return}b==="record"&&l&&q.push({path:"/tools/upload-record",query:{id:l.id}})},U=b=>{N.value=!1,c.value=!1,b&&a()};return(b,l)=>{const L=u("el-input"),s=u("el-form-item"),P=u("el-option"),j=u("el-select"),$=u("el-button"),G=u("el-form"),O=u("LyPageWrapper"),D=u("el-table-column"),Q=u("el-table"),W=u("ly-pagination"),H=I("loading");return x(),S("div",null,[e(O,{title:"查询条件",class:"mb16px"},{default:t(()=>[e(G,{ref:"queryRef",model:f.value,inline:!0},{default:t(()=>[e(s,{prop:"classification"},{default:t(()=>[e(L,{modelValue:f.value.classification,"onUpdate:modelValue":l[0]||(l[0]=i=>f.value.classification=i),placeholder:"请输入分类",clearable:"",maxlength:"50"},null,8,["modelValue"])]),_:1}),e(s,{prop:"tableName"},{default:t(()=>[e(L,{modelValue:f.value.tableName,"onUpdate:modelValue":l[1]||(l[1]=i=>f.value.tableName=i),placeholder:"请输入表名称",clearable:"",maxlength:"50"},null,8,["modelValue"])]),_:1}),e(s,{prop:"tableNa"},{default:t(()=>[e(L,{modelValue:f.value.tableNa,"onUpdate:modelValue":l[2]||(l[2]=i=>f.value.tableNa=i),placeholder:"请输入表名",clearable:"",maxlength:"50"},null,8,["modelValue"])]),_:1}),e(s,{prop:"tableType"},{default:t(()=>[e(j,{modelValue:f.value.tableType,"onUpdate:modelValue":l[3]||(l[3]=i=>f.value.tableType=i),class:"select-brand",placeholder:"请选择表类型",clearable:"",style:{width:"200px"},onClear:p},{default:t(()=>[e(P,{label:"全量表",value:"1"}),e(P,{label:"增量表",value:"2"})]),_:1},8,["modelValue"])]),_:1}),e(s,null,{default:t(()=>[e($,{type:"primary",icon:"Search",loading:r.value,onClick:l[4]||(l[4]=i=>o())},{default:t(()=>l[8]||(l[8]=[g(" 搜索 ")])),_:1},8,["loading"]),e($,{icon:"Refresh",loading:r.value,onClick:k},{default:t(()=>l[9]||(l[9]=[g(" 重置 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),e(O,{title:"手工表"},{toolButton:t(()=>[e($,{type:"primary",icon:"plus",onClick:l[5]||(l[5]=i=>m("add"))},{default:t(()=>l[10]||(l[10]=[g(" 新建表 ")])),_:1})]),default:t(()=>[R((x(),E(Q,{data:v.value},{default:t(()=>[e(D,{label:"分类",prop:"classification"}),e(D,{label:"表名",prop:"tableNa"}),e(D,{label:"表类型",prop:"tableType"},{default:t(({row:i})=>[i.tableType==="1"?(x(),S("span",de,"全量表")):i.tableType==="2"?(x(),S("span",re,"增量表")):w("",!0)]),_:1}),e(D,{label:"创建时间",prop:"createTime"}),e(D,{label:"更新时间",prop:"updateTime"}),e(D,{label:"操作",align:"center",width:"300",fixed:"right"},{default:t(({row:i})=>[e($,{type:"primary",link:"",plain:"",onClick:A=>m("view",i)},{default:t(()=>l[11]||(l[11]=[g(" 查看 ")])),_:2},1032,["onClick"]),e($,{type:"primary",link:"",plain:"",onClick:A=>m("edit",i)},{default:t(()=>l[12]||(l[12]=[g(" 编辑 ")])),_:2},1032,["onClick"]),e($,{type:"primary",link:"",plain:"",onClick:A=>m("delete",i)},{default:t(()=>l[13]||(l[13]=[g(" 删除 ")])),_:2},1032,["onClick"]),e($,{type:"primary",link:"",plain:"",onClick:A=>m("upload",i)},{default:t(()=>l[14]||(l[14]=[g(" 上传文件 ")])),_:2},1032,["onClick"]),e($,{type:"primary",link:"",plain:"",onClick:A=>m("record",i)},{default:t(()=>l[15]||(l[15]=[g(" 上传记录 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[H,r.value]]),R(e(W,{page:d.value.pageNo,"onUpdate:page":l[6]||(l[6]=i=>d.value.pageNo=i),limit:d.value.pageSize,"onUpdate:limit":l[7]||(l[7]=i=>d.value.pageSize=i),total:d.value.total,onPagination:a},null,8,["page","limit","total"]),[[Z,d.value.total>0]])]),_:1}),N.value?(x(),E(ne,{key:0,"modal-title":V.value,"edit-data":n.value,"request-api":T.value,onClose:U},null,8,["modal-title","edit-data","request-api"])):w("",!0),c.value?(x(),E(ue,{key:1,"modal-title":V.value,"edit-data":n.value,onClose:U},null,8,["modal-title","edit-data"])):w("",!0)])}}});export{ve as default};
//# sourceMappingURL=index-a2b0a31d.js.map
